# ปฏิบัติการที่ 9: สร้าง App ง่ายๆ ด้วย Async/Await

## สร้าง Todo App ที่มี Timer ให้แต่ละ task

### ส่วนที่ 1: การทำความเข้าใจโค้ด

- **คำถาม 1.1** เหตุใดจึงต้องแยก duration และ timeLeft ออกจากกัน อธิบายความแตกต่าง
  - duration = เวลาเริ่มต้น
  - timeLeft = เวลาที่เหลือที่ลดลงเรื่อย ๆ
- **คำถาม 1.2** formatTime() ฟังก์ชันนี้ทำความสำคัญอะไร? ถ้าไม่มีฟังก์ชันนี้ app จะเป็นยังไง
  - แปลงวินาทีเป็นรูปแบบ นาที:วินาที ให้แสดงผลอ่านง่าย ถ้าไม่มีจะแสดงเป็นตัวเลขวินาทีล้วน
- **คำถาม 1.3** อธิบายข้อแตกต่างระหว่าง setInterval() และ setTimeout()
  - setInterval() ทำซ้ำทุกช่วงเวลา
  - setTimeout() ทำงานครั้งเดียว

### ส่วนที่ 2: ฟังก์ชันการทำงาน

- **คำถาม 2.1** เมื่อผู้ใช้คลิกปุ่ม “▶️ เริ่ม” ครั้งแรก เกิดอะไรขึ้นในลำดับใด (ระบุขั้นตอนอย่างน้อย 4 ขั้น)
  - เรียก toggleTimer()
  - ตั้ง setInterval()
  - ลด timeLeft
  - renderTasks() อัปเดต UI
- **คำถาม 2.2** ในฟังก์ชัน toggleTimer() ทำไมจึงต้องมี clearInterval() ก่อนแล้วจึงตั้ง task.isRunning = false
  - เพื่อหยุด interval ก่อน ป้องกัน timer ซ้อนกัน
- **คำถาม 2.3** ถ้า timer หมดเวลา จะเกิดความผิดพลาดใดหากไม่มี clearInterval()
  - Timer จะติดลบและทำงานไม่หยุด

### ส่วนที่ 3: DOM และ UI

- **คำถาม 3.1** ฟังก์ชัน renderTasks() สามารถแยกออกเป็นฟังก์ชันย่อยได้กี่ฟังก์ชัน จงเสนอการแยกที่เหมาะสม
  - แยกได้ เช่น สร้าง element / ผูก event / อัปเดตเวลา
- **คำถาม 3.2** ใช้วิธีใดในการอัปเดต UI ทุกครั้งที่ timer เปลี่ยนแปลง มีวิธีการอื่นนอกเหนือจำนวนปัจจุบันหรือไม่
  - เรียก renderTasks() ใหม่ทุกครั้ง หรืออัปเดตเฉพาะ element ที่เปลี่ยน
- **คำถาม 3.3** “keypress” event listener ทำความสำคัญอะไร หากลบออกไป app จะเป็นยังไง
  - ใช้ตรวจจับปุ่ม Enter ถ้าลบออกต้องกดปุ่มเพิ่มเท่านั้น

### ส่วนที่ 4: Web Audio API

- **คำถาม 4.1** อธิบายหน้าที่ของการตั้งค่า:
  - oscillator.frequency.value = 800 (800 = ความถี่เสียง)
  - oscillator.type = "sine" ("sine" = รูปแบบคลื่น)
  - gainNode.gain.setValueAtTime(0.3, audioContext.currentTime) (0.3 = ระดับเสียง)
- **คำถาม 4.2** ทำไมเสียง alarm จึงใช้เวลา 0.5 วินาที แล้วหยุด ถ้าเพิ่มเป็น 2 วินาทีจะส่งผลต่อ UX อย่างไร
  - 0.5 วิ ไม่รบกวนมาก ถ้า 2 วิ อาจน่ารำคาญ

### ส่วนที่ 5: Array Methods

- **คำถาม 5.1** ในฟังก์ชัน deleteTask(id) ใช้ filter() เพื่ออะไร เขียนวิธีอื่นแทน filter() ได้หรือไม่
  - ใช้ filter() เพื่อลบ task สามารถใช้ findIndex()+splice() แทนได้
- **คำถาม 5.2** ในฟังก์ชัน renderTasks() ใช้ map() เพื่อทำอะไร ถ้าใช้ forEach() แทนจะดีหรือไม่
  - map() ใช้สร้างรายการใหม่ forEach() ก็ได้แต่ไม่เหมาะเท่า

### ส่วนที่ 6: ข้อบกพร่องและการแก้ไข

- **คำถาม 6.1** หากผู้ใช้เพิ่ม task 2 อัน แล้วคลิก “เริ่ม” บน task ทั้ง 2 อันพร้อมๆ กัน จะเกิดอะไรขึ้น
  - จะมีหลาย interval ทำงานพร้อมกัน
- **คำถาม 6.2** ถ้า timer กำลังเดินอยู่ และผู้ใช้รีเฟรชหน้า (F5) task จะหายไป ทำไม วิธีแก้ปัญหาคือ
  - เพราะข้อมูลเก็บใน memory แก้โดยใช้ localStorage
- **คำถาม 6.3** ในการทดสอบ app ที่ timer 30 นาที จะใช้เวลานานไปหรือไม่ เสนอวิธีทดสอบที่เร็วขึ้น
  - ช้าเกินไป ควรลดเวลาเหลือ 10–30 วินาทีตอนทดสอบ

### ส่วนที่ 7: Enhancement

- **คำถาม 7.1** หากต้องการเพิ่มฟังก์ชัน “รีเซ็ต timer” คืนไปเป็น 30 นาที โค้ดจะเป็นยังไง
  - ตั้ง timeLeft = duration แล้ว render ใหม่
- **คำถาม 7.2** วิธีใดในการเก็บ tasks ไว้ใน LocalStorage เพื่อไม่ให้หายเมื่อรีเฟรชหน้า
  - ใช้ localStorage.setItem() และ JSON.stringify()
- **คำถาม 7.3** ถ้าต้องการให้ผู้ใช้กำหนดเวลา timer เอง จะต้องแก้ไขฟังก์ชันไหนบ้าง
  - แก้ addTask() ให้รับค่าเวลาจากผู้ใช้

### ส่วนที่ 8: Concepts เชิงลึก

- **คำถาม 8.1** ทำไม renderTasks() จึงต้องเรียกหลายครั้ง มีวิธี DRY ที่ดีกว่าหรือไม่
  - เพื่อให้ UI ตรงกับข้อมูล อาจปรับให้อัปเดตเฉพาะส่วนที่เปลี่ยน
- **คำถาม 8.2** ถ้าเปลี่ยนจาก setInterval เป็น requestAnimationFrame จะส่งผลดีหรือไม่
  - ไม่เหมาะ เพราะ requestAnimationFrame ทำงานถี่เกินไป
- **คำถาม 8.3** ในโค้ดที่ใช้ setInterval() มี Memory Leak ที่อาจเกิดขึ้นได้หรือไม่
  - ไม่เหมาะ เพราะ requestAnimationFrame ทำงานถี่เกินไป

### ประเมินตนเอง

- ดี ตอบคำถามได้ 1-2 ข้อ ทำให้ app ทำงานได้

---

## สร้าง Pomodoro Timer - เทคนิคในการจัดการเวลา

### ส่วนที่ 1: ความเข้าใจเทคนิค Pomodoro

- **คำถาม 1.1** เทคนิค Pomodoro คืออะไร เหตุใดจึงเลือกใช้เวลา 25 นาที สำหรับการทำงาน
  - เทคนิคทำงาน 25 นาที พัก 5 นาที เพื่อเพิ่มสมาธิ 25 นาทีเป็นช่วงเวลาที่สมองโฟกัสได้ดี
- **คำถาม 1.2** หากต้องการปรับเวลา Work/Break ให้แตกต่างจาก default (25/5) จะต้องแก้ไขโค้ดส่วนไหน
  - แก้ค่าตัวแปร WORK_TIME และ BREAK_TIME หรือค่าที่กำหนด duration
- **คำถาม 1.3** ทำไมหลังจาก 4 รอบ (pomodoros) จึงมี Long Break ขนาด 15 นาที ประโยชน์คืออะไร
  - หลัง 4 รอบมี Long Break 15 นาที เพื่อพักลึก ลดความล้า

### ส่วนที่ 2: การจัดโครงสร้าง State

- **คำถาม 2.1** ปัจจุบัน app เก็บ state อะไรบ้าง เช่น:เวลาที่เหลือ,Phase (work/break),Rounds counter
  - timeLeft
  - phase (work/break)
  - rounds
  - timerInterval
  - isRunning
- **คำถาม 2.2** ทำไมจึงต้องมี rounds state หากแค่เก็บ phase ก็พอ
  - เพราะต้องนับครบ 4 รอบเพื่อ Long Break phase อย่างเดียวไม่พอ
- **คำถาม 2.3** ถ้าต้องการให้ Pomodoro Count อัปเดต เมื่อจบแต่ละ Work phase จะแก้ไขฟังก์ชัน completePhase() ยังไง
  - เพิ่ม rounds++ เมื่อจบ work phase ใน completePhase()

### ส่วนที่ 3: Timer Logic

- **คำถาม 3.1** อธิบายการทำงานของ setInterval() ในส่วน timer - จะเกิดอะไรขึ้นทุก 1 วินาที
  - ทุก 1 วิ จะลด timeLeft-- และอัปเดต UI
- **คำถาม 3.2** เหตุใดจึงต้องมี timerInterval เป็น global variable ถ้าไม่มี app จะเป็นยังไง
  - เพื่อเก็บ id ของ interval ไว้หยุด ถ้าไม่มีจะหยุดไม่ได้
- **คำถาม 3.3** ถ้าผู้ใช้คลิก “เริ่ม” 2 ครั้งติดต่อกัน จะเกิดอะไรขึ้น มีวิธีแก้หรือไม่
  - จะเกิด interval ซ้อนกัน แก้โดยเช็ค isRunning ก่อนเริ่ม

### ส่วนที่ 4: DOM & UI

- **คำถาม 4.1** ฟังก์ชัน updateDisplay() ทำอะไร ต้องเรียกจากที่ไหนบ้าง
  - อัปเดตเวลา phase progress bar ต้องเรียกทุกครั้งที่เวลาเปลี่ยน
- **คำถาม 4.2** formatTime() ใช้ padding ด้วย padStart(2, "0") เพื่ออะไร ถ้าไม่มี timer จะแสดง 5:3 แทน 05:03 ได้หรือไม่
  - padStart ทำให้เลขมี 2 หลัก เช่น 05:03 ถ้าไม่มีจะเป็น 5:3
- **คำถาม 4.3** Progress bar คำนวณเปอร์เซ็นต์ยังไง เขียนสูตรออกมา
  - เปอร์เซ็นต์ = (timePassed / totalTime) _ 100 หรือ ((totalTime - timeLeft) / totalTime) _ 100

### ส่วนที่ 5: Events & Controls

- **คำถาม 5.1** ปุ่มควบคุมมีอะไรบ้าง (Start, Pause, Reset, Settings) แต่ละปุ่มเรียกฟังก์ชันไหน
  - Start → startTimer()
  - Pause → pauseTimer()
  - Reset → resetTimer()
  - Settings → openSettings()
- **คำถาม 5.2** ทำไม Pause ต้องหยุด timer ด้วย clearInterval() หากไม่ทำจะไปไป
  - เพื่อหยุด interval ถ้าไม่หยุด timer จะยังเดินอยู่
- **คำถาม 5.3** Reset button ควรตั้งค่ากลับเป็นอะไร
  - timeLeft = ค่าเริ่มต้น
  - phase = work
  - rounds = 0
  - timerInterval = clearInterval(timerInterval)

### ส่วนที่ 6: Notifications

- **คำถาม 6.1** ฟังก์ชัน playSound() ใช้เทคนิคอะไรในการสร้างเสียง (Web Audio API? HTML Audio?)
  - ใช้ Web Audio API หรือ HTML Audio
- **คำถาม 6.2** ทำไม notification ควร work/break ต่างกันอย่างไร เสียง alarm ที่ดีควรเป็นยังไง
  - Work → เสียงกระตุ้น
  - Break → เสียงเบากว่า
  - alarm ควรสั้น ชัด ไม่รบกวน
- **คำถาม 6.3** ถ้าต้องการเพิ่ม Desktop Notification ด้วย Browser Notification API จะแก้ไขฟังก์ชัน completePhase() ยังไง
  - เพิ่ม new Notification("Time's up!") ใน completePhase()

### ส่วนที่ 7: Progress Tracking & Stats

- **คำถาม 7.1** Stats ต้องติดตามข้อมูลอะไร
  - Pomodoros ที่เสร็จแล้ว = จำนวน pomodoros
  - เวลารวมที่ทำงาน = เวลารวม
  - Long breaks ที่เกิดขึ้น
- **คำถาม 7.2** ตำแหน่งที่ดีที่สุดในการอัปเดต stats คือที่ไหน
  - ใน conpletePhase() ตอนจบ work
- **คำถาม 7.3** วิธีการบันทึก stats ไว้ใน LocalStorage ได้อย่างไร
  - localStorage.setItem("stats", JSON.stringify(stats))

### ส่วนที่ 8: Bug Detection

- **คำถาม 8.1** ถ้า timer กำลังเดินอยู่ แล้วผู้ใช้เปิด DevTools ขนาดใหญ่ timer จะยังคงเดินต่อหรือไม่
  - ยังเดินต่อ แต่ถ้า tab inactive อาจหน่วง
- **คำถาม 8.2** ถ้า completePhase() เรียก ในขณะที่ timer ยังวิ่งอยู่ จะเกิด memory leak ได้หรือไม่
  - มีได้ ถ้าไม่ clearInterval()
- **คำถาม 8.3** ใน mobile ถ้าผู้ใช้ล็อก screen ขณะ timer เดิน timer จะหยุดหรือยังคงเดิน วิธีแก้คืออะไร
  - มือถืออาจหยุดเมื่อ background แก้โดยใช้ timestamp คำนวณเวลาจริงแทนการนับ --

### ส่วนที่ 9: Architecture & Code Quality

- **คำถาม 9.1** ถ้าต้องการแยก Timer logic ออกจาก UI ควรสร้าง class อย่างไร
  - สร้าง class Timer มี start, pause, reset
- **คำถาม 9.2** Functions ที่มีมากควรจัดไว้ใน object เพื่อจัดการได้ดีขึ้นหรือไม่
  - ควรจัดเป็น object เพื่อจัดการง่าย
- **คำถาม 9.3** Code reusability - ส่วนไหนของโค้ดสามารถทำให้เป็น utility functions ได้
  - formatTime(), playSound(), calculateProgress() เป็น utility ได้

### ส่วนที่ 10: Enhancements

- **คำถาม 10.1** วิธีเพิ่ม Dark Mode ควรแก้ไข CSS/JS ส่วนไหนบ้าง
  - เพิ่ม class dark-mode ใน CSS และ toggle ด้วย JS
- **คำถาม 10.2** วิธีบันทึกประวัติการใช้งาน (session history) คืออะไร
  - เก็บ session ลง array แล้วบันทึกใน localStorage
- **คำถาม 10.3** วิธีเพิ่ม Keyboard Shortcuts (Space = Start/Pause, R = Reset) ควรใช้ event ไหน
  - ใช้ keydown event listener

### ประเมินตนเอง

- ดี ตอบคำถามได้ 1-2 ข้อ ทำให้ app ทำงานได้

---
