# ปฏิบัติการที่ 9: สร้าง App ง่ายๆ ด้วย Async/Await

## สร้าง Todo App ที่มี Timer ให้แต่ละ task

### ส่วนที่ 1: การทำความเข้าใจโค้ด

- **คำถาม 1.1** เหตุใดจึงต้องแยก duration และ timeLeft ออกจากกัน อธิบายความแตกต่าง
  - duration = เวลาเริ่มต้น
  - timeLeft = เวลาที่เหลือที่ลดลงเรื่อย ๆ
- **คำถาม 1.2** formatTime() ฟังก์ชันนี้ทำความสำคัญอะไร? ถ้าไม่มีฟังก์ชันนี้ app จะเป็นยังไง
  - แปลงวินาทีเป็นรูปแบบ นาที:วินาที ให้แสดงผลอ่านง่าย ถ้าไม่มีจะแสดงเป็นตัวเลขวินาทีล้วน
- **คำถาม 1.3** อธิบายข้อแตกต่างระหว่าง setInterval() และ setTimeout()
  - setInterval() ทำซ้ำทุกช่วงเวลา
  - setTimeout() ทำงานครั้งเดียว

### ส่วนที่ 2: ฟังก์ชันการทำงาน

- **คำถาม 2.1** เมื่อผู้ใช้คลิกปุ่ม “▶️ เริ่ม” ครั้งแรก เกิดอะไรขึ้นในลำดับใด (ระบุขั้นตอนอย่างน้อย 4 ขั้น)
  - เรียก toggleTimer()
  - ตั้ง setInterval()
  - ลด timeLeft
  - renderTasks() อัปเดต UI
- **คำถาม 2.2** ในฟังก์ชัน toggleTimer() ทำไมจึงต้องมี clearInterval() ก่อนแล้วจึงตั้ง task.isRunning = false
  - เพื่อหยุด interval ก่อน ป้องกัน timer ซ้อนกัน
- **คำถาม 2.3** ถ้า timer หมดเวลา จะเกิดความผิดพลาดใดหากไม่มี clearInterval()
  - Timer จะติดลบและทำงานไม่หยุด

### ส่วนที่ 3: DOM และ UI

- **คำถาม 3.1** ฟังก์ชัน renderTasks() สามารถแยกออกเป็นฟังก์ชันย่อยได้กี่ฟังก์ชัน จงเสนอการแยกที่เหมาะสม
  - แยกได้ เช่น สร้าง element / ผูก event / อัปเดตเวลา
- **คำถาม 3.2** ใช้วิธีใดในการอัปเดต UI ทุกครั้งที่ timer เปลี่ยนแปลง มีวิธีการอื่นนอกเหนือจำนวนปัจจุบันหรือไม่
  - เรียก renderTasks() ใหม่ทุกครั้ง หรืออัปเดตเฉพาะ element ที่เปลี่ยน
- **คำถาม 3.3** “keypress” event listener ทำความสำคัญอะไร หากลบออกไป app จะเป็นยังไง
  - ใช้ตรวจจับปุ่ม Enter ถ้าลบออกต้องกดปุ่มเพิ่มเท่านั้น

### ส่วนที่ 4: Web Audio API

- **คำถาม 4.1** อธิบายหน้าที่ของการตั้งค่า:
  - oscillator.frequency.value = 800 (800 = ความถี่เสียง)
  - oscillator.type = "sine" ("sine" = รูปแบบคลื่น)
  - gainNode.gain.setValueAtTime(0.3, audioContext.currentTime) (0.3 = ระดับเสียง)
- **คำถาม 4.2** ทำไมเสียง alarm จึงใช้เวลา 0.5 วินาที แล้วหยุด ถ้าเพิ่มเป็น 2 วินาทีจะส่งผลต่อ UX อย่างไร
  - 0.5 วิ ไม่รบกวนมาก ถ้า 2 วิ อาจน่ารำคาญ

### ส่วนที่ 5: Array Methods

- **คำถาม 5.1** ในฟังก์ชัน deleteTask(id) ใช้ filter() เพื่ออะไร เขียนวิธีอื่นแทน filter() ได้หรือไม่
  - ใช้ filter() เพื่อลบ task สามารถใช้ findIndex()+splice() แทนได้
- **คำถาม 5.2** ในฟังก์ชัน renderTasks() ใช้ map() เพื่อทำอะไร ถ้าใช้ forEach() แทนจะดีหรือไม่
  - map() ใช้สร้างรายการใหม่ forEach() ก็ได้แต่ไม่เหมาะเท่า

### ส่วนที่ 6: ข้อบกพร่องและการแก้ไข

- **คำถาม 6.1** หากผู้ใช้เพิ่ม task 2 อัน แล้วคลิก “เริ่ม” บน task ทั้ง 2 อันพร้อมๆ กัน จะเกิดอะไรขึ้น
  - จะมีหลาย interval ทำงานพร้อมกัน
- **คำถาม 6.2** ถ้า timer กำลังเดินอยู่ และผู้ใช้รีเฟรชหน้า (F5) task จะหายไป ทำไม วิธีแก้ปัญหาคือ
  - เพราะข้อมูลเก็บใน memory แก้โดยใช้ localStorage
- **คำถาม 6.3** ในการทดสอบ app ที่ timer 30 นาที จะใช้เวลานานไปหรือไม่ เสนอวิธีทดสอบที่เร็วขึ้น
  - ช้าเกินไป ควรลดเวลาเหลือ 10–30 วินาทีตอนทดสอบ

### ส่วนที่ 7: Enhancement

- **คำถาม 7.1** หากต้องการเพิ่มฟังก์ชัน “รีเซ็ต timer” คืนไปเป็น 30 นาที โค้ดจะเป็นยังไง
  - ตั้ง timeLeft = duration แล้ว render ใหม่
- **คำถาม 7.2** วิธีใดในการเก็บ tasks ไว้ใน LocalStorage เพื่อไม่ให้หายเมื่อรีเฟรชหน้า
  - ใช้ localStorage.setItem() และ JSON.stringify()
- **คำถาม 7.3** ถ้าต้องการให้ผู้ใช้กำหนดเวลา timer เอง จะต้องแก้ไขฟังก์ชันไหนบ้าง
  - แก้ addTask() ให้รับค่าเวลาจากผู้ใช้

### ส่วนที่ 8: Concepts เชิงลึก

- **คำถาม 8.1** ทำไม renderTasks() จึงต้องเรียกหลายครั้ง มีวิธี DRY ที่ดีกว่าหรือไม่
  - เพื่อให้ UI ตรงกับข้อมูล อาจปรับให้อัปเดตเฉพาะส่วนที่เปลี่ยน
- **คำถาม 8.2** ถ้าเปลี่ยนจาก setInterval เป็น requestAnimationFrame จะส่งผลดีหรือไม่
  - ไม่เหมาะ เพราะ requestAnimationFrame ทำงานถี่เกินไป
- **คำถาม 8.3** ในโค้ดที่ใช้ setInterval() มี Memory Leak ที่อาจเกิดขึ้นได้หรือไม่
  - ไม่เหมาะ เพราะ requestAnimationFrame ทำงานถี่เกินไป

### ประเมินตนเอง

- ดี ตอบคำถามได้ 1-2 ข้อ ทำให้ app ทำงานได้
